# Задачи по разработке обёртки Neosintez API

## Выполненные задачи
- [x] Создание базовой структуры проекта
- [x] ЗАДАЧА 1: Рефакторинг и разбор монолита
- [x] ЗАДАЧА 2: Унификация атрибутов
- [x] **ЗАДАЧА 3: Сервис-слой CRUD** ✅

## Текущие задачи

### ✅ ЗАДАЧА 3: Сервис-слой CRUD (ВЫПОЛНЕНА)
- **цель**: Реализовать сервисный слой для работы с объектами через Pydantic-модели
- **статус**: ✅ **ПОЛНОСТЬЮ ВЫПОЛНЕНА**
- **результат**: Полнофункциональный CRUD-сервис с типизированными Pydantic-моделями
- **файлы изменены**:
  - ✅ neosintez_api/services/object_service.py - полный CRUD-функционал
  - ✅ neosintez_api/services/__init__.py - экспорт сервисов
  - ✅ scripts/test_crud_service.py - комплексное тестирование
  - ✅ neosintez_api/client.py - файл-заглушка для обратной совместимости
  - ✅ neosintez_api/config.py - добавлено поле verify_ssl
  - ✅ neosintez_api/utils.py - исправлена функция build_attribute_body
  - ✅ neosintez_api/services/mappers/object_mapper.py - оптимизирован маппинг

**Реализованный функционал:**
- ✅ **CREATE**: Создание объектов с автоматической установкой атрибутов из Pydantic-модели
- ✅ **READ**: Чтение объектов с преобразованием атрибутов обратно в Pydantic-модель  
- ✅ **UPDATE**: Дифференциальное обновление атрибутов (update_attrs) - отправляются только изменившиеся значения
- ✅ **DELETE**: Удаление объектов (через базовый клиент)
- ✅ **Типизация**: Полная поддержка TypeScript-подобной типизации через Pydantic
- ✅ **Маппинг**: Автоматическое преобразование между API и моделями с поддержкой алиасов
- ✅ **Валидация**: Pydantic-валидация данных на входе и выходе
- ✅ **Кэширование**: Кэш атрибутов классов для оптимизации производительности

**Протестированные сценарии:**
- ✅ Полный цикл CREATE → READ → UPDATE → READ
- ✅ Корректность маппинга атрибутов по алиасам (МВЗ, ID стройки Адепт)
- ✅ Обновление только изменившихся атрибутов
- ✅ Правильная обработка типов данных (строки, числа)

### ЗАДАЧА 4: Тестирование
- **цель**: Обеспечить качество кода через автоматизированные тесты
- **файлы для изменения**:
  - tests/test_type_mapping.py
  - tests/test_cache.py
  - tests/test_validation.py
  - tests/test_integration.py
  - .github/workflows/pytest.yml
- **шаги**:
  1. Создать unit-тесты для маппинга типов, кэша TTL и валидации
  2. Настроить мок-сервер для интеграционных тестов
  3. Создать сценарий тестирования create → read → update_attrs
  4. Настроить GitHub Actions для автоматического запуска тестов

### ЗАДАЧА 5: Импорт из Excel
- **цель**: Создать механизм импорта данных из Excel в Неосинтез через Pydantic-модели
- **файлы для изменения**:
  - neosintez_api/excel_import.py
  - scripts/test_excel_import.py
  - requirements.txt
- **шаги**:
  1. Добавить зависимости pandas и openpyxl
  2. Реализовать чтение Excel и преобразование в Pydantic-модели
  3. Обеспечить параллельное создание объектов с ограничением нагрузки
  4. Добавить формирование отчета о результатах импорта

## Будущие задачи

### ЗАДАЧА 6: CLI и пользовательские удобства
- **цель**: Создать удобный интерфейс командной строки для работы с API
- **файлы для изменения**:
  - neosintez_api/__main__.py
  - scripts/cli_examples.py
  - README.md
- **шаги**:
  1. Реализовать CLI-интерфейс для основных операций
  2. Добавить режим dry-run для проверки без внесения изменений
  3. Интегрировать прогресс-бар для отслеживания выполнения
  4. Обновить документацию с примерами использования

### ЗАДАЧА 7: Будущие улучшения
- **цель**: Расширить функциональность библиотеки и упростить архитектуру
- **файлы для изменения**:
  - neosintez_api/plugins/fastapi_plugin.py
  - neosintez_api/services/bulk_operations.py
  - neosintez_api/core/retry.py
  - neosintez_api/services/model_generator.py
- **шаги**:
  1. Реорганизовать структуру проекта для четкого разделения ответственности
     ```
     neosintez_api/
     ├── core/             # Ядро SDK
     │   ├── client.py     # Единый клиент API
     │   ├── resources/    # Ресурсы для работы с API
     │   └── models/       # API модели
     ├── models/           # Доменные модели
     ├── services/         # Сервисный слой
     │   ├── object_service.py
     │   └── mappers/      # Маппинги моделей
     └── utils/            # Общие утилиты
     ```
  2. Создать FastAPI-плагин для генерации CRUD
  3. Добавить поддержку массового обновления объектов
  4. Реализовать механизм retry с exponential backoff
  5. Разработать функционал авто-генерации Pydantic-моделей
